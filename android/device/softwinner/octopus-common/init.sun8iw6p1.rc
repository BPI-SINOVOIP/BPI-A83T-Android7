import init.common.rc
import init.device.rc
import init.sun8iw6p1.usb.rc

on init
    # Set permissions for persist partition
    mkdir /persist 0771 system system
    mkdir /firmware 0771 system system

    # Support legacy paths
    symlink /sdcard /mnt/sdcard
    symlink /sdcard /storage/sdcard0

    mkdir /oem 0550 system system

on early-fs
    insmod nand.ko
    mount_all /fstab.sun8iw6p1
    swapon_all /fstab.sun8iw6p1
    restorecon_recursive /persist

    wait /dev/block/by-name/media_data
    mount vfat /dev/block/by-name/media_data /oem ro nosuid nodev utf8,context=u:object_r:oemfs:s0

on fs
    ### display
    #insmod /system/vendor/modules/sunxi_tr.ko
    insmod /system/vendor/modules/disp.ko
    insmod /system/vendor/modules/hdmi.ko
    #insmod /system/vendor/modules/led-sunxi-respiration.ko
    #insmod /system/vendor/modules/ledtrig-sunxi-respiration.ko
    # gpu
    insmod /system/vendor/modules/pvrsrvkm.ko
    # sw-keystore
    mkdir /cache/HWML 0770 root system
    insmod /system/vendor/modules/sunxi_schw.ko
    chmod 0660 /dev/scdev
    chown keystore keystore /dev/scdev
    #keyboard
    #insmod /system/vendor/modules/sunxi-keyboard.ko
    #gpio driver
    insmod /system/vendor/modules/gpio-sunxi.ko

on post-fs-data
    #mkdir /data/media 0770 media_rw media_rw
    # Set indication (checked by vold) that we have finished this action
    setprop vold.post_fs_data_done 1

on boot
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chmod 0660 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor

    chown system system /sys/kernel/autohotplug/enable
    chmod 0660 /sys/kernel/autohotplug/enable

    chown system system /sys/devices/system/cpu/cpu0/cpufreq/boot_lock
    chmod 0660 /sys/devices/system/cpu/cpu0/cpufreq/boot_lock

    chown system system /sys/devices/soc/cpu_budget_cool.7/roomage
    chmod 0660 /sys/devices/soc/cpu_budget_cool.7/roomage

    chown system system /sys/class/devfreq/sunxi-ddrfreq/dsm/scene
    chmod 0660 /sys/class/devfreq/sunxi-ddrfreq/dsm/scene

    chown system system /sys/devices/platform/pvrsrvkm/dvfs/android
    chmod 0660 /sys/devices/platform/pvrsrvkm/dvfs/android

    chown system system /sys/devices/platform/pvrsrvkm/scenectrl/status
    chmod 0660 /sys/devices/platform/pvrsrvkm/scenectrl/status

    chown system system /sys/devices/platform/pvrsrvkm/scenectrl/command
    chmod 0660 /sys/devices/platform/pvrsrvkm/scenectrl/command

    chown system system /sys/class/disp/disp/attr/enhance_mode
    chown system system /sys/class/disp/disp/attr/operate_3d_mode

on charger
    insmod sunxi_tr.ko
    insmod disp.ko
    class_start charger
    write /sys/module/printk/parameters/console_suspend N
    write /proc/sys/kernel/printk 0

# GPU service
service pvrsrvctl /system/vendor/bin/pvrsrvctl --start
        class core
        user root
        group root
        oneshot
